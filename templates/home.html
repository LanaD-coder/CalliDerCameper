{% extends "base.html" %}
{% load static %}
{% load i18n %}

{% block content %}
<div class="banner text-center position-relative" style="position: relative;">
  <div class="banner-text">
    <h2 class="display-4 fw-bold" style="font-family: Cookie;">{% trans "Calli explores the world – and you can join in!" %}</h2>
    <p>
      {% blocktrans %}
      Calli is more than just a camper – he’s our little adventure on four wheels.
      But instead of just using him ourselves, we want other people to experience the freedom of travel too.
      That way, Calli keeps discovering new places, and you might find your very own favorite spot.
      {% endblocktrans %}
    </p>
  </div>

  <!-- Cookie Toast placed at top-left of banner -->
  <div id="cookieToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-autohide="false"
      style="position: absolute; bottom: 10px; left: 10px; z-index: 9999; min-width: 280px;">
    <div class="toast-header">
      <strong class="me-auto">Cookies</strong>
      <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
    <div class="toast-body">
      Diese Website verwendet Cookies. <a href="{% url 'datenschutz' %}">Mehr erfahren</a>.
      <button id="acceptCookiesBtn" class="btn btn-primary btn-sm ms-2">OK</button>
    </div>
  </div>
</div>

<section id="destinations-section">
  <h2>{% trans "Recommended Camping Destinations" %}</h2>
  <div class="destinations-list">
    {% for dest in destinations %}
      <div class="destination-card">
        <img src="{{ dest.image.url }}" alt="{{ dest.name }}" />
        <h3>{{ dest.name }}</h3>
        <p>{{ dest.description }}</p>

        {% if dest.website_url %}
          <p><a href="{{ dest.website_url }}" target="_blank" rel="noopener">{% trans "Visit Website" %}</a></p>
        {% endif %}

        {% if dest.map_url %}
        <div class="map-responsive">
          <iframe
            src="{{ dest.map_url }}"
            width="600"
            height="450"
            style="border:0;"
            allowfullscreen=""
            loading="lazy"
            referrerpolicy="no-referrer-when-downgrade">
          </iframe>
        </div>
        {% endif %}
      </div>
    {% empty %}
      <p>{% trans "No destinations available at the moment." %}</p>
    {% endfor %}
  </div>
</section>

{% get_current_language as LANGUAGE_CODE %}


<script>
document.addEventListener('DOMContentLoaded', function () {
  console.log('Toast init');

  if (typeof bootstrap === 'undefined' || !bootstrap.Toast) {
    console.log('Bootstrap Toast not available');
    return;
  }

  const cookieToastEl = document.getElementById('cookieToast');
  const acceptBtn = document.getElementById('acceptCookiesBtn');

  if (!cookieToastEl) {
    console.log('Toast element not found');
    return;
  }

  const cookiesAccepted = localStorage.getItem('cookiesAccepted');

  if (!cookiesAccepted) {
    const cookieToast = new bootstrap.Toast(cookieToastEl, { autohide: false });
    cookieToast.show();

    acceptBtn?.addEventListener('click', function () {
      localStorage.setItem('cookiesAccepted', 'true');
      cookieToast.hide();
      console.log('Cookies accepted and toast hidden');
    });
  } else {
    console.log('Cookies already accepted, toast not shown');
  }
});
</script>

<!-- Welcome Toast Container -->
<div class="toast-container position-fixed bottom-0 start-0 p-3" style="z-index: 1055;">
  <div id="welcomeToast" class="toast text-black bg-white position-relative" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="5000">
    <button type="button" class="btn-close position-absolute top-0 start-0 m-2" style="filter: invert(0);" data-bs-dismiss="toast" aria-label="Close"></button>
    <div class="toast-body">
      <span>{% trans "Welcome!" %}</span>
      {% trans "Please" %}
      <a href="{% url 'account_signup' %}" class="text-decoration-underline" style="color: #ebae16;">{% trans "Register" %}</a>
      {% trans "or" %}
      <a href="{% url 'account_login' %}" class="text-decoration-underline" style="color: #ebae16;">{% trans "Login" %}</a>
      {% trans "to get started." %}
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const welcomeToastEl = document.getElementById('welcomeToast');
  if (welcomeToastEl && bootstrap && bootstrap.Toast) {
    const welcomeToast = new bootstrap.Toast(welcomeToastEl);
    welcomeToast.show();
  }
});
</script>
{% endblock %}
