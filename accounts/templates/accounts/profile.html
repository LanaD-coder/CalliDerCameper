{% extends "base.html" %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "Mein Profil" %}{% endblock %}

{% block content %}
<div class="container my-4">
  <div class="card shadow-sm" style="border-top-right-radius: 8px;">
    <div class="card-body">
      <h1 class="card-title mb-4">{% trans "Buchungen" %}</h1>

      {% if bookings %}
      <div class="table-responsive" style="overflow-x: auto;">
        <table class="table table-striped table-hover align-middle mb-0" style="table-layout: auto; width: 100%;">
          <thead class="table-dark">
            <tr>
              <th scope="col">{% trans "Wohnmobil" %}</th>
              <th scope="col">{% trans "Startdatum" %}</th>
              <th scope="col">{% trans "Enddatum" %}</th>
            </tr>
          </thead>
          <tbody>
            {% for booking in bookings %}
              {% if booking.payment_status == "paid" %}
                <tr class="booking-toggle" data-bs-toggle="collapse" data-bs-target="#bookingDetails{{ booking.id }}" aria-expanded="false" aria-controls="bookingDetails{{ booking.id }}" style="cursor: pointer;">
                  <td class="text-break">
                    {{ booking.campervan.name }}
                    <i class="bi bi-chevron-down float-end transition" id="toggleIcon{{ booking.id }}"></i>
                  </td>
                  <td>{{ booking.start_date }}</td>
                  <td>{{ booking.end_date }}</td>
                </tr>
                <tr class="collapse" id="bookingDetails{{ booking.id }}">
                  <td colspan="4">
                    <div class="p-3 bg-light border rounded overflow-auto">
                      <div class="text-wrap text-break">
                        <div class="p-3 bg-light border rounded overflow-auto">
                          <ul>
                            <li><strong>Campervan:</strong> {{ booking.campervan.name }}</li>
                            <li><strong>Buchungsnummer:</strong> {{ booking.booking_number }}</li>
                            <li><strong>Startdatum:</strong> {{ booking.start_date|date:"d.m.Y" }}</li>
                            <li><strong>Enddatum:</strong> {{ booking.end_date|date:"d.m.Y" }}</li>
                            <li><strong>Kautionsbetrag:</strong> €{{ booking.deposit|default:"1000"|floatformat:2 }}</li>
                            <li><strong>Gesamtpreis:</strong> €{{ booking.total_price|floatformat:2 }}
                              <br>
                              <small class="text-muted">
                                <i class="fa-solid fa-circle-exclamation me-1"></i> Grundpreis exkl. MwSt. und Zusatzleistungen
                              </small>
                            </li>
                          </ul>
                        </div>
                      </div>
                    </div>
                  </td>
                </tr>
              {% endif %}
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <p class="text-muted fst-italic">{% trans "Sie haben noch keine Buchungen." %}</p>
      {% endif %}
      <hr>
      <p>
        {% trans "Wir sind begeisterte Camper und haben auf unseren Reisen einige echte Geheimtipps entdeckt. Wenn Sie ein wenig Inspiration für Ihre nächste Reise brauchen, schauen Sie doch bei unseren" %}
        <a href="{% url 'videos' %}">{% trans "Empfohlenen Campingzielen" %}</a>!
      </p>

      <p>
        {% trans "Wenn Sie Änderungen an Ihren Buchungen vornehmen müssen, bitte" %}
        <a href="{% url 'contact' %}">{% trans "Kontaktieren Sie uns" %}</a>.
      </p>
    </div>
  </div>
</div>

<script>
  document.querySelectorAll('.booking-toggle').forEach(row => {
    row.addEventListener('click', () => {
      const icon = row.querySelector('i');
      const targetId = row.getAttribute('data-bs-target');
      const target = document.querySelector(targetId);

      if (target.classList.contains('show')) {
        icon.classList.remove('rotate-180');
      } else {
        icon.classList.add('rotate-180');
      }
    });
  });
</script>

{% endblock %}
